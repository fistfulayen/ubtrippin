# PRD 020 Phase 1 — Email/Password Authentication

## Context
Currently the app only supports Google OAuth. PRD 020 adds email/password and magic link as Phase 1, with Apple/Microsoft/GitHub in later phases.

## What to Build

### 1. Email/Password Sign Up & Sign In
- Add email/password form to `/login` page alongside existing Google OAuth button
- Two modes: Sign Up (creates account) and Sign In (existing account)
- Use Supabase Auth `signUp` and `signInWithPassword`
- Password requirements: minimum 8 characters
- After signup: send confirmation email via Supabase (built-in)
- After signin: redirect to `/trips`

### 2. Magic Link
- Add "Sign in with email link" option
- Use Supabase Auth `signInWithOtp` with `email` option
- User enters email → receives link → clicks → logged in
- Redirect URL: `${NEXT_PUBLIC_APP_URL}/auth/callback`

### 3. Password Reset
- "Forgot password?" link on login page
- Uses Supabase Auth `resetPasswordForEmail`
- Redirect to `/auth/reset-password` page where user sets new password
- Use `updateUser({ password })` after token validation

### 4. Update Login Page UI
- Clean layout with three sections:
  1. Google OAuth button (existing)
  2. Divider: "or"
  3. Email form with toggle between Sign In / Sign Up / Magic Link / Forgot Password
- Mobile-first, matches white + indigo/slate design system
- Form validation with inline error messages

### Files to Create/Modify
- `src/app/(auth)/login/page.tsx` — add email form
- `src/app/(auth)/login/email-form.tsx` — client component for email auth
- `src/app/(auth)/reset-password/page.tsx` — password reset page
- `src/app/(auth)/callback/route.ts` — may need updates for magic link + reset flows

### Supabase Config Required
In Supabase Dashboard → Authentication → URL Configuration:
- Site URL: `https://www.ubtrippin.xyz`
- Redirect URLs: `https://www.ubtrippin.xyz/auth/callback`

In Authentication → Email Templates (optional, can use defaults):
- Confirmation email
- Magic link email
- Password reset email

### Tech Stack
- Next.js 16 App Router, TypeScript, Tailwind CSS, pnpm
- Supabase Auth (built-in email/password support)
- Do NOT use createSecretClient(). Auth uses the browser client.
- This code will be security-audited monthly.

### Quality
- `npx tsc --noEmit` must pass
- `pnpm build` must compile
- No `any` types
- Password input must use `type="password"`
- Form must handle all error states (wrong password, email taken, etc.)
