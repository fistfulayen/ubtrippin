# PRD 015 Phase 3 — MCP Tools + CLI + Docs

You are building Phase 3 of Family Sharing for UBTRIPPIN, a Next.js 16 app with Supabase and a companion MCP server.

**Phases 1 and 2 are already built** — families table, CRUD API, invite flow, shared loyalty/profiles/guides/trips endpoints all exist.

## What to Build

### 1. MCP Tools (`mcp/src/tools/`)

Add these tools to the existing MCP server at `mcp/`:

```typescript
// Family management
list_families        // GET /api/v1/families
get_family           // GET /api/v1/families/:id (includes member list)

// Shared data across family
get_family_loyalty   // GET /api/v1/families/:id/loyalty
lookup_family_loyalty // GET /api/v1/families/:id/loyalty/lookup?provider=X
get_family_profiles  // GET /api/v1/families/:id/profiles
get_family_trips     // GET /api/v1/families/:id/trips
get_family_guides    // GET /api/v1/families/:id/guides
```

Follow the existing MCP tool patterns in `mcp/src/tools/`. Each tool should:
- Use the existing API client/fetch helper
- Include proper input schemas (zod)
- Return structured JSON
- Handle errors gracefully

Update `mcp/src/index.ts` to register the new tools.
Update `mcp/package.json` version to `1.8.0`.

### 2. CLI Commands (`cli/ubt`)

Add family commands to the existing bash CLI at `cli/ubt`:

```bash
ubt family list                              # List families
ubt family create "Rogers Family"            # Create a family
ubt family show <family_id>                  # Show family + members
ubt family invite <family_id> <email>        # Invite member
ubt family remove <family_id> <user_id>      # Remove member
ubt family leave <family_id>                 # Leave family
ubt family loyalty <family_id>               # List all family loyalty programs
ubt family loyalty lookup <family_id> <provider>  # Provider lookup
ubt family profiles <family_id>              # All member profiles
ubt family trips <family_id>                 # All family trips
ubt family guides <family_id>               # All family guides
```

Follow the existing CLI patterns — the CLI calls the REST API using curl with the API key from `UBT_API_KEY` env var. Base URL from `UBT_API_URL` (default: `https://www.ubtrippin.xyz/api/v1`).

### 3. Documentation

**`docs/FAMILY.md`** — Agent guide for family features:
- Overview of family sharing model ("sharing is caring" — all or nothing)
- How to create a family and invite members
- How to query shared data (loyalty, profiles, trips, guides)
- Email routing behavior (auto-routes to family trips)
- Example MCP tool calls
- Example CLI commands
- FAQ: what happens when someone leaves, what's shared, Pro requirements

**Update `docs/API.md`**:
- Add Family section with all endpoints
- Include request/response examples
- Note Pro requirements (create family, invite — Pro only; membership — free)

**Update `README.md`**:
- Add Family Sharing to feature list
- Brief description in the features section

### 4. Update Help/Settings

If a help page or `/docs/agents` page exists, add family section.

## Important Patterns

- MCP server is at `mcp/` — it's a separate TypeScript project, excluded from root tsconfig
- CLI is a bash script at `cli/ubt` — uses curl + jq
- API base URL must use `www.ubtrippin.xyz` (non-www strips auth headers)
- pnpm package manager for the MCP project
- Run `cd mcp && npx tsc --noEmit` to check MCP types
- Run `npx tsc --noEmit` in root to check main app types

## Do NOT

- Modify Phase 1 or Phase 2 code
- Add privacy controls or sharing toggles
- Touch billing/payment code
